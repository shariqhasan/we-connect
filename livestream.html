<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0B0421" />
  <title>Instagram Style Live Stream</title>

  <!-- ‚úÖ Lottie Player Script -->
  <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js" type="module"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #000;
      color: white;
      overflow: hidden;
    }
    .stream-container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    video {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }
    .lottie-loader {
      position: absolute;
      width: 300px;
      height: 300px;
      z-index: 10;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.8);
    }
    .hidden {
      display: none;
    }
    .header {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 3;
      background: rgba(0,0,0,0.6);
      padding: 8px 14px;
      border-radius: 30px;
    }
    .viewer-count {
      margin-left: auto;
      background: rgba(255,255,255,0.2);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 13px;
    }
    .floating-hearts { position: absolute; right: 20px; bottom: 120px; z-index: 3; pointer-events: none; }
    .heart { position: absolute; font-size: 22px; animation: float 2s linear forwards; }
    @keyframes float { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-200px); opacity: 0; } }
    .chat-section { position: absolute; right: 20px; top: 80px; width: 280px; z-index: 3; display: flex; flex-direction: column; gap: 10px; }
    .chat-bubble { display: flex; align-items: center; background: rgba(0,0,0,0.6); padding: 8px 12px; border-radius: 20px; animation: fadeOut 0.5s ease-out forwards; animation-delay: 4.5s; }
    .chat-bubble img { width: 30px; height: 30px; border-radius: 50%; margin-right: 10px; }
    .chat-bubble .content { display: flex; flex-direction: column; }
    .chat-bubble .username { font-weight: bold; font-size: 13px; }
    .chat-bubble .text { font-size: 13px; word-break: break-word; }
    @keyframes fadeOut { to { opacity: 0; transform: translateX(50%); } }
    .chat-input { position: absolute; bottom: 20px; left: 20px; width: calc(100% - 140px); z-index: 3; display: flex; }
    .chat-input input { flex: 1; padding: 10px 14px; border-radius: 25px; border: none; outline: none; font-size: 14px; }
    .chat-input button { margin-left: 10px; padding: 10px 18px; border: none; border-radius: 25px; background: #FFEB00; color: black; font-weight: bold; cursor: pointer; }
    .actions { position: absolute; right: 20px; bottom: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 3; }
    .actions button { padding: 10px 14px; border: none; border-radius: 50%; background-color: rgba(255, 235, 0, 0.9); color: black; font-size: 16px; cursor: pointer; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; }
    .tips { position: absolute; bottom: 0; left: 0; width: 100%; text-align: center; background-color: rgba(0, 0, 0, 0.5); padding: 5px 0; font-size: 12px; z-index: 3; }
  </style>
</head>
<body>
  <div class="stream-container">

    <!-- ‚úÖ Lottie Loading Animation -->
    <div id="loadingOverlay" class="lottie-loader">
      <dotlottie-wc
        src="https://lottie.host/6ac0f53f-2676-403f-a24e-a951cff9619c/PTGqRip8OL.lottie"
        style="width: 300px; height: 300px"
        speed="1"
        autoplay
        loop>
      </dotlottie-wc>
    </div>

    <video id="liveVideo" autoplay muted playsinline></video>

    <div class="header">
      <div class="name">LIVE</div>
    </div>

    <div class="floating-hearts" id="floatingHearts"></div>
    <div class="chat-section" id="chatBox"></div>

    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Send a message..." />
      <button onclick="sendMessage()">Send</button>
    </div>

    <div class="actions">
      <button onclick="sendHeart()">‚ù§Ô∏è</button>
      <button onclick="sendFollow()">+</button>
      <button onclick="goToPrivateChat()">üí¨</button>
    </div>

    <div class="tips">
      ‚ö†Ô∏è Never share private info. Stay safe on We Connect.
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      query,
      onSnapshot,
      orderBy,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyASlmUQeDx8EdW-n8KT7dqFA13yloBIPt8",
      authDomain: "we-connect-847f4.firebaseapp.com",
      projectId: "we-connect-847f4",
      storageBucket: "we-connect-847f4.appspot.com",
      messagingSenderId: "530150260251",
      appId: "1:530150260251:web:abc123def456gh789ijk"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const chatRef = collection(db, 'liveChat');
    const chatBox = document.getElementById('chatBox');

    const sampleAvatars = [
      "https://i.pravatar.cc/40?u=user1",
      "https://i.pravatar.cc/40?u=user2",
      "https://i.pravatar.cc/40?u=user3"
    ];

    const usernames = ["Ali", "Sara", "Rahul", "Maya", "Zayn"];

    const q = query(chatRef, orderBy("timestamp"));
    onSnapshot(q, (snapshot) => {
      snapshot.docChanges().forEach(change => {
        if (change.type === "added") {
          const msg = change.doc.data();
          showMessageBubble(msg.text);
        }
      });
    });

    function showMessageBubble(message) {
      const chatBubble = document.createElement("div");
      chatBubble.className = "chat-bubble";

      const avatar = document.createElement("img");
      avatar.src = sampleAvatars[Math.floor(Math.random() * sampleAvatars.length)];

      const content = document.createElement("div");
      content.className = "content";

      const username = document.createElement("div");
      username.className = "username";
      username.textContent = usernames[Math.floor(Math.random() * usernames.length)];

      const text = document.createElement("div");
      text.className = "text";
      text.textContent = message;

      content.appendChild(username);
      content.appendChild(text);
      chatBubble.appendChild(avatar);
      chatBubble.appendChild(content);
      chatBox.appendChild(chatBubble);

      chatBox.scrollTop = chatBox.scrollHeight;
      setTimeout(() => chatBubble.remove(), 5000);
    }

    window.sendMessage = async function () {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text) return;
      await addDoc(chatRef, {
        text,
        timestamp: serverTimestamp()
      });
      input.value = "";
    };

    window.sendFollow = () => alert("‚úÖ You followed the streamer!");
    window.goToPrivateChat = () => window.location.href = "private-chat.html";

    window.sendHeart = () => {
      const hearts = ["‚ù§Ô∏è", "üíñ", "üíò", "üíú", "üíô", "üíö", "üß°"];
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.style.right = `${Math.random() * 30}px`;
      heart.style.bottom = "0px";
      heart.innerText = hearts[Math.floor(Math.random() * hearts.length)];
      document.getElementById("floatingHearts").appendChild(heart);
      setTimeout(() => heart.remove(), 2000);
    };

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        document.getElementById('liveVideo').srcObject = stream;
        document.getElementById('loadingOverlay').classList.add('hidden');
      })
      .catch(err => {
        console.error("Camera Access Error:", err);
        alert("Unable to access camera. Please allow permissions.");
      });
  </script>
</body>
</html>
